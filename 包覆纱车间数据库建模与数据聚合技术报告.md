

# ğŸ“˜ åŒ…è¦†çº±è½¦é—´èƒ½è€—æ•°æ®åº“å»ºæ¨¡ä¸æ•°æ®èšåˆæŠ€æœ¯æŠ¥å‘Š

---

## ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸ç›®æ ‡
åŒ…è¦†çº±è½¦é—´èƒ½è€—æ•°æ®å¹³å°æ—¨åœ¨å®ç°å¯¹ç”Ÿäº§è®¾å¤‡èƒ½è€—çš„å…¨è¿‡ç¨‹é‡‡é›†ã€èšåˆä¸åˆ†æã€‚ç³»ç»Ÿé€šè¿‡å¯¹ç§’çº§ä¸åŠå°æ—¶çº§åŸå§‹æ•°æ®çš„ç»Ÿä¸€å…¥æ± ä¸å¤šå±‚èšåˆï¼Œä¸ºåç«¯åˆ†æä¸å‰ç«¯èƒ½æ•ˆå¯è§†åŒ–æä¾›ç»Ÿä¸€æ•°æ®æºã€‚

**ç›®æ ‡ï¼š**
- å®ç°èƒ½è€—æ•°æ®çš„é«˜é¢‘é‡‡é›†ã€åˆ†å±‚èšåˆä¸é«˜æ•ˆæŸ¥è¯¢ï¼›
- æ”¯æŒå°æ—¶ã€å¤©ã€å‘¨ã€æœˆç­‰å¤šæ—¶é—´å°ºåº¦çš„åˆ†æï¼›
- ä¿è¯æ–°æ•°æ®å¢é‡å…¥æ± ä¸å†å²æ•°æ®å›çŒå‡å¯è‡ªåŠ¨æ›´æ–°èšåˆç»“æœã€‚

---

## äºŒã€æ•°æ®åº“æ•´ä½“æ¶æ„
æ•°æ®åº“é‡‡ç”¨ **PostgreSQL + TimescaleDB** æ—¶åºæ‰©å±•å»ºæ¨¡ï¼Œæ•´ä½“é€»è¾‘åˆ†ä¸ºå››å±‚ï¼š

| å±‚çº§ | è¡¨å | åŠŸèƒ½è¯´æ˜ |
|------|------|----------|
| æºæ•°æ®å±‚ | `datahistf`ã€`archivestore_cacu_hist` | ç§’çº§ä¸åŠå°æ—¶çº§åŸå§‹æ•°æ®è¡¨ |
| ç»´è¡¨å±‚ | `dim_device`ã€`dim_point` | è®¾å¤‡ä¸ç‚¹ä½å®šä¹‰è¡¨ |
| äº‹å®å±‚ | `fact_measure_raw`ã€`fact_metric_hour` | ç»Ÿä¸€æ—¶åºå…¥æ± ä¸å°æ—¶èšåˆè¡¨ |
| èšåˆå±‚ | `cagg_measure_hour`ã€`cagg_metric_day/week/month` | è¿ç»­èšåˆè§†å›¾ |

---

## ä¸‰ã€æ•°æ®å»ºæ¨¡è®¾è®¡

### 3.1 è®¾å¤‡ç»´è¡¨ï¼ˆ`dim_device`ï¼‰
```sql
CREATE TABLE "public"."dim_device" (
  "device_sk" "pg_catalog"."int8" NOT NULL DEFAULT nextval('dim_device_device_sk_seq'::regclass),
  "devid" "pg_catalog"."int4" NOT NULL,
  "devname" "pg_catalog"."text" COLLATE "pg_catalog"."default" NOT NULL,
  "device_type" "pg_catalog"."text" COLLATE "pg_catalog"."default",
  "workshop" "pg_catalog"."text" COLLATE "pg_catalog"."default",
  "line_id" "pg_catalog"."text" COLLATE "pg_catalog"."default",
  "gauge_set" "pg_catalog"."text" COLLATE "pg_catalog"."default",
  "vendor" "pg_catalog"."text" COLLATE "pg_catalog"."default",
  "install_date" "pg_catalog"."date",
  "status" "pg_catalog"."text" COLLATE "pg_catalog"."default",
  "updated_at" "pg_catalog"."timestamptz" DEFAULT now()
)
;
```
> ç”¨äºå®šä¹‰åŒ…è¦†æœºã€æ’é£æœºã€é£æœºå˜é¢‘å™¨ã€æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ç­‰è®¾å¤‡åŸºç¡€ä¿¡æ¯ã€‚

### 3.2 ç‚¹ä½ç»´è¡¨ï¼ˆ`dim_point`ï¼‰
```sql
CREATE TABLE "public"."dim_point" (
  "point_sk" "pg_catalog"."int8" NOT NULL DEFAULT nextval('dim_point_point_sk_seq'::regclass),
  "dataid" "pg_catalog"."bpchar" COLLATE "pg_catalog"."default" NOT NULL,
  "devid" "pg_catalog"."int4",
  "devname" "pg_catalog"."text" COLLATE "pg_catalog"."default",
  "propname" "pg_catalog"."text" COLLATE "pg_catalog"."default",
  "unit" "pg_catalog"."text" COLLATE "pg_catalog"."default",
  "setzoomfact" "pg_catalog"."numeric",
  "datatype" "pg_catalog"."int2",
  "iotype" "pg_catalog"."int2",
  "remark" "pg_catalog"."text" COLLATE "pg_catalog"."default",
  "ha" "pg_catalog"."float8",
  "hha" "pg_catalog"."float8",
  "la" "pg_catalog"."float8",
  "lla" "pg_catalog"."float8",
  "is_active" "pg_catalog"."bool" DEFAULT true,
  "updated_at" "pg_catalog"."timestamptz" DEFAULT now()
)
;
```
> æ¯ä¸ªè®¾å¤‡å¯æœ‰å¤šä¸ªç‚¹ä½å‚æ•°ï¼ˆåŠŸç‡ã€ç”µæµã€ç”µå‹ã€è½¬é€Ÿã€æ¸©æ¹¿åº¦ç­‰ï¼‰ã€‚

### 3.3 è®¾å¤‡èƒ¶åˆè¡¨(device_mapping)

```sql
CREATE TABLE "public"."device_mapping" (
  "id" "pg_catalog"."int8" NOT NULL DEFAULT nextval('device_mapping_id_seq'::regclass),
  "src_system" "pg_catalog"."varchar" COLLATE "pg_catalog"."default" NOT NULL,
  "src_table" "pg_catalog"."varchar" COLLATE "pg_catalog"."default" NOT NULL,
  "src_code" "pg_catalog"."varchar" COLLATE "pg_catalog"."default",
  "device_sk" "pg_catalog"."int8",
  "device_code" "pg_catalog"."varchar" COLLATE "pg_catalog"."default",
  "match_confidence" "pg_catalog"."int4" DEFAULT 100,
  "created_at" "pg_catalog"."timestamptz" DEFAULT now(),
  "updated_at" "pg_catalog"."timestamptz" DEFAULT now(),
  "src_pnum" "pg_catalog"."varchar" COLLATE "pg_catalog"."default"
)
;
```



### 3.4 è®¾å¤‡èµ„äº§è¡¨(ECAINFO)(SQLSERVER)

```sql

-- ----------------------------
-- Table structure for ECAINFO
-- ----------------------------
IF EXISTS (SELECT * FROM sys.all_objects WHERE object_id = OBJECT_ID(N'[dbo].[ECAINFO]') AND type IN ('U'))
	DROP TABLE [dbo].[ECAINFO]
GO

CREATE TABLE [dbo].[ECAINFO] (
  [ID] int  IDENTITY(1,1) NOT NULL,
  [Prjid] int  NOT NULL,
  [prjname] varchar(100) COLLATE Chinese_PRC_CI_AS  NULL,
  [EName] varchar(100) COLLATE Chinese_PRC_CI_AS  NULL,
  [Etype] varchar(20) COLLATE Chinese_PRC_CI_AS  NULL,
  [Edescp] varchar(255) COLLATE Chinese_PRC_CI_AS  NULL,
  [addr] varchar(100) COLLATE Chinese_PRC_CI_AS  NULL,
  [fzr] varchar(50) COLLATE Chinese_PRC_CI_AS  NULL,
  [assetscale] int  NULL,
  [PId] int  NULL,
  [PName] varchar(100) COLLATE Chinese_PRC_CI_AS  NULL,
  [lxr] varchar(50) COLLATE Chinese_PRC_CI_AS  NULL,
  [pnum] varchar(50) COLLATE Chinese_PRC_CI_AS  NULL,
  [epid] varchar(20) COLLATE Chinese_PRC_CI_AS  NULL,
  [feeaCcounts] varchar(50) COLLATE Chinese_PRC_CI_AS  NULL,
  [lever] varchar(20) COLLATE Chinese_PRC_CI_AS  NULL,
  [elever] varchar(20) COLLATE Chinese_PRC_CI_AS  NULL,
  [ePower] float(53)  NULL,
  [vlever] int  NULL,
  [srev1] varchar(50) COLLATE Chinese_PRC_CI_AS  NULL,
  [srev2] varchar(50) COLLATE Chinese_PRC_CI_AS  NULL,
  [srev3] varchar(50) COLLATE Chinese_PRC_CI_AS  NULL,
  [srev4] varchar(50) COLLATE Chinese_PRC_CI_AS  NULL,
  [srev5] varchar(50) COLLATE Chinese_PRC_CI_AS  NULL,
  [irev1] int  NULL,
  [irev2] int  NULL,
  [irev3] int  NULL,
  [irev4] int  NULL,
  [irev5] int  NULL,
  [remark] varchar(60) COLLATE Chinese_PRC_CI_AS  NULL
)
GO

ALTER TABLE [dbo].[ECAINFO] SET (LOCK_ESCALATION = TABLE)
GO

```



---

## å››ã€åŸå§‹æ•°æ®å±‚è®¾è®¡

### 4.1 ç§’çº§é‡‡é›†è¡¨ï¼ˆ`datahistf`ï¼‰
```sql
CREATE TABLE public.datahistf (
  opdate TIMESTAMP(6) NOT NULL,
  val    DOUBLE PRECISION NOT NULL,
  dataid CHAR(8) NOT NULL
);
COMMENT ON TABLE public.datahistf IS 'ç§’çº§é‡‡é›†æ•°æ®è¡¨';
```

### 4.2 åŠå°æ—¶å½’æ¡£è¡¨ï¼ˆ`archivestore_cacu_hist`ï¼‰
```sql
CREATE TABLE public.archivestore_cacu_hist (
  id      SERIAL PRIMARY KEY,
  recdt   TIMESTAMP(6) NOT NULL,
  gtype   INT,
  bval    DOUBLE PRECISION,
  eval    DOUBLE PRECISION,
  addval  DOUBLE PRECISION,
  dataid  CHAR(8) NOT NULL
);
COMMENT ON TABLE public.archivestore_cacu_hist IS 'åŠå°æ—¶å½’æ¡£èƒ½è€—æ•°æ®è¡¨';
```

4.3 

---

## äº”ã€äº‹å®å±‚è®¾è®¡

### 5.1 åŸå§‹å…¥æ± è¡¨ï¼ˆ`fact_measure_raw`ï¼‰
```sql
CREATE TABLE IF NOT EXISTS public.fact_measure_raw (
  ts        TIMESTAMPTZ NOT NULL,
  point_sk  BIGINT NOT NULL REFERENCES public.dim_point(point_sk),
  val_raw   DOUBLE PRECISION NOT NULL,
  val_norm  DOUBLE PRECISION NOT NULL,
  quality   SMALLINT DEFAULT 0,
  source    TEXT DEFAULT 'ods',
  load_at   TIMESTAMPTZ DEFAULT now(),
  PRIMARY KEY (ts, point_sk)
);
SELECT create_hypertable('public.fact_measure_raw', 'ts', if_not_exists=>TRUE);
```

### 5.2 å°æ—¶èšåˆè¡¨ï¼ˆ`fact_metric_hour`ï¼‰
```sql
CREATE TABLE IF NOT EXISTS public.fact_metric_hour (
  ts_hour  TIMESTAMPTZ NOT NULL,
  point_sk BIGINT NOT NULL REFERENCES public.dim_point(point_sk),
  v_avg    DOUBLE PRECISION NOT NULL,
  PRIMARY KEY (ts_hour, point_sk)
);
SELECT create_hypertable('public.fact_metric_hour', 'ts_hour', if_not_exists=>TRUE);
```

---

## å…­ã€è¿ç»­èšåˆè®¾è®¡

| èšåˆå±‚ | æ—¶é—´ç²’åº¦ | æºè¡¨ | è¾“å‡ºå­—æ®µ | è¯´æ˜ |
|---------|------------|--------|-------------|------|
| cagg_measure_5min | 5min | `fact_measure_raw` | æœ«å€¼ | è‡ªåŠ¨èšåˆ |
| `cagg_measure_hour` | 1å°æ—¶ | `fact_measure_raw` | å¹³å‡å€¼ | è‡ªåŠ¨èšåˆ |
| `cagg_metric_day` | 1å¤© | `cagg_measure_hour` | å¹³å‡å€¼ | ç”¨äºæ—¥åˆ†æ |
| `cagg_metric_week` | 1å‘¨ | `cagg_measure_hour` | å¹³å‡å€¼ | ç”¨äºå‘¨åˆ†æ |
| `cagg_metric_month` | 1æœˆ | `cagg_measure_hour` | å¹³å‡å€¼ | ç”¨äºæœˆåˆ†æ |

ç¤ºä¾‹ï¼š
```sql
CREATE MATERIALIZED VIEW IF NOT EXISTS public.cagg_measure_5min
WITH (timescaledb.continuous) AS
SELECT
    time_bucket('5 minutes', ts) AS ts_5min,   -- 5min æ—¶é—´æ¡¶
    point_sk,                                  -- ç‚¹ä½
    AVG(val_raw)                        AS v_avg,   -- 5min å†…å¹³å‡å€¼
    MIN(val_raw)                        AS v_min,   -- 5min å†…æœ€å°å€¼
    MAX(val_raw)                        AS v_max,   -- 5min å†…æœ€å¤§å€¼
    (array_agg(val_raw ORDER BY ts DESC))[1] AS v_last  -- 5min å†…â€œæœ«å€¼â€
FROM public.fact_measure_raw
WHERE source = 'datahistf'                            -- åªç”¨ datahistf çš„åŸå§‹æ•°æ®
GROUP BY 1, 2
WITH NO DATA;                                         -- å»ºå®Œåå¯ä»¥æ‰‹åŠ¨ refresh å†å²åŒºé—´



CREATE MATERIALIZED VIEW IF NOT EXISTS public.cagg_measure_hour
WITH (timescaledb.continuous) AS
SELECT
  time_bucket('1 hour', ts) AS ts_hour,
  point_sk,
  AVG(val_norm) AS v_avg
FROM public.fact_measure_raw
GROUP BY 1,2
WITH NO DATA;


SELECT add_continuous_aggregate_policy('public.cagg_measure_hour',
  start_offset => INTERVAL '2 days',
  end_offset => INTERVAL '1 hour',
  schedule_interval => INTERVAL '30 minutes');
```

---

### ä¸ƒã€çŠ¶æ€å»ºæ¨¡ä¸­é—´å±‚

7.1 5minè¾“å…¥æ ·æœ¬è¡¨(GMMä¸“ç”¨,ml_state_input_5min)



```
CREATE TABLE "public"."ml_state_input_5min" (
  "device_id" "pg_catalog"."text" COLLATE "pg_catalog"."default" NOT NULL,
  "ts_window" "pg_catalog"."timestamptz" NOT NULL,
  "power_avg_kw" "pg_catalog"."float8",
  "tension_ratio" "pg_catalog"."float8",
  "output_kg_1h" "pg_catalog"."float8",
  "unit_kwh_per_kg" "pg_catalog"."float8",
  "energy_cum_kwh" "pg_catalog"."float8",
  "weight_cum_kg" "pg_catalog"."float8",
  "meter_cum_m" "pg_catalog"."float8",
  "delta_energy_kwh" "pg_catalog"."float8",
  "delta_weight_kg" "pg_catalog"."float8",
  "delta_meter_m" "pg_catalog"."float8",
  "log_unit_kwh_per_kg" "pg_catalog"."float8",
  "all_energy" "pg_catalog"."float8",
  "current_production" "pg_catalog"."float8",
  "current_meter" "pg_catalog"."float8",
  "all_meter" "pg_catalog"."float8",
  "all_weight" "pg_catalog"."float8",
  "all_time" "pg_catalog"."float8",
  "allruntime" "pg_catalog"."float8",
  "runtimes" "pg_catalog"."float8",
  "complete_weight" "pg_catalog"."float8",
  "all_power_1" "pg_catalog"."float8",
  "a_power_1" "pg_catalog"."float8",
  "b_power_1" "pg_catalog"."float8",
  "c_power_1" "pg_catalog"."float8",
  "a_power_2" "pg_catalog"."float8",
  "b_power_2" "pg_catalog"."float8",
  "c_power_2" "pg_catalog"."float8",
  "all_power_2" "pg_catalog"."float8",
  "a_power_3" "pg_catalog"."float8",
  "b_power_3" "pg_catalog"."float8",
  "c_power_3" "pg_catalog"."float8",
  "all_power_3" "pg_catalog"."float8",
  "juanqu_v" "pg_catalog"."float8",
  "qianshen_v" "pg_catalog"."float8",
  "weiru_v" "pg_catalog"."float8",
  "pulling_ratio" "pg_catalog"."float8",
  "up_speed" "pg_catalog"."float8",
  "down_speed" "pg_catalog"."float8",
  "up_twist" "pg_catalog"."float8",
  "down_twist" "pg_catalog"."float8",
  "boot_time" "pg_catalog"."float8",
  "initial_stroke" "pg_catalog"."float8",
  "vertebral_angle" "pg_catalog"."float8",
  "crossover_angle" "pg_catalog"."float8",
  "monolithic_concave" "pg_catalog"."float8",
  "weisha_distance" "pg_catalog"."float8",
  "hardedge_width" "pg_catalog"."float8",
  "weisha_time" "pg_catalog"."float8",
  "hardedge_adjust" "pg_catalog"."float8",
  "down_delay" "pg_catalog"."float8",
  "up_delay" "pg_catalog"."float8",
  "stacking_t" "pg_catalog"."float8",
  "stacking_coefficient" "pg_catalog"."float8",
  "spandex_fiber" "pg_catalog"."float8",
  "upper_pack_denier" "pg_catalog"."float8",
  "lower_pack_denier" "pg_catalog"."float8",
  "traverse_shutdown" "pg_catalog"."float8",
  "boot_protect_width" "pg_catalog"."float8",
  "origin_offset_distance" "pg_catalog"."float8",
  "speed_wheel_diameter" "pg_catalog"."float8",
  "transverse_speed" "pg_catalog"."float8",
  "compensation_factor" "pg_catalog"."float8",
  "weight_correction" "pg_catalog"."float8",
  "spindle_diameter" "pg_catalog"."float8",
  "tube_diameter" "pg_catalog"."float8",
  "max_diameter" "pg_catalog"."float8",
  "gauge_set" "pg_catalog"."float8",
  "crankroll_diameter" "pg_catalog"."float8",
  "draftingroll_diameter" "pg_catalog"."float8",
  "feedroll_diameter" "pg_catalog"."float8",
  "t_coefficient" "pg_catalog"."float8",
  "hardedge_position" "pg_catalog"."float8",
  "anti_flanging_layer" "pg_catalog"."float8",
  "completep" "pg_catalog"."float8",
  "a_voltage" "pg_catalog"."float8",
  "b_voltage" "pg_catalog"."float8",
  "c_voltage" "pg_catalog"."float8",
  "a_current" "pg_catalog"."float8",
  "b_current" "pg_catalog"."float8",
  "c_current" "pg_catalog"."float8",
  "a_frequency" "pg_catalog"."float8",
  "b_frequency" "pg_catalog"."float8",
  "c_frequency" "pg_catalog"."float8"
);

-- ----------------------------
-- Records of ml_state_input_5min
-- ----------------------------

-- ----------------------------
-- Primary Key structure for table ml_state_input_5min
-- ----------------------------
ALTER TABLE "public"."ml_state_input_5min" ADD CONSTRAINT "ml_state_input_5min_pkey" PRIMARY KEY ("device_id", "ts_window");

```

7.2  5min æ‰“åˆ†ç»“æœè¡¨ï¼ˆGMM + èƒ½æ•ˆï¼‰

```sql
CREATE TABLE "public"."ml_state_sample_5min" (
  "device_id" "pg_catalog"."text" COLLATE "pg_catalog"."default" NOT NULL,
  "ts_window" "pg_catalog"."timestamptz" NOT NULL,
  "power_avg_kw" "pg_catalog"."float8",
  "tension_ratio" "pg_catalog"."float8",
  "output_kg_1h" "pg_catalog"."float8",
  "unit_kwh_per_kg" "pg_catalog"."float8",
  "energy_cum_kwh" "pg_catalog"."float8",
  "weight_cum_kg" "pg_catalog"."float8",
  "meter_cum_m" "pg_catalog"."float8",
  "delta_energy_kwh" "pg_catalog"."float8",
  "delta_weight_kg" "pg_catalog"."float8",
  "delta_meter_m" "pg_catalog"."float8",
  "log_unit_kwh_per_kg" "pg_catalog"."float8",
  "energy_kwh_sample" "pg_catalog"."float8",
  "bf_status" "pg_catalog"."float8",
  "cluster" "pg_catalog"."int4",
  "cluster_proba_max" "pg_catalog"."float8",
  "state_label" "pg_catalog"."text" COLLATE "pg_catalog"."default",
  "state_group" "pg_catalog"."text" COLLATE "pg_catalog"."default",
  "sec_baseline_kwh_per_kg" "pg_catalog"."float8",
  "efficiency_pct" "pg_catalog"."float8",
  "load_rate_pct_7d" "pg_catalog"."float8",
  "all_energy" "pg_catalog"."float8",
  "current_production" "pg_catalog"."float8",
  "current_meter" "pg_catalog"."float8",
  "all_power_1" "pg_catalog"."float8",
  "all_power_2" "pg_catalog"."float8",
  "all_power_3" "pg_catalog"."float8",
  "a_power_1" "pg_catalog"."float8",
  "b_power_1" "pg_catalog"."float8",
  "c_power_1" "pg_catalog"."float8",
  "a_power_2" "pg_catalog"."float8",
  "b_power_2" "pg_catalog"."float8",
  "c_power_2" "pg_catalog"."float8",
  "a_power_3" "pg_catalog"."float8",
  "b_power_3" "pg_catalog"."float8",
  "c_power_3" "pg_catalog"."float8",
  "a_voltage" "pg_catalog"."float8",
  "b_voltage" "pg_catalog"."float8",
  "c_voltage" "pg_catalog"."float8",
  "a_current" "pg_catalog"."float8",
  "b_current" "pg_catalog"."float8",
  "c_current" "pg_catalog"."float8",
  "a_frequency" "pg_catalog"."float8",
  "b_frequency" "pg_catalog"."float8",
  "c_frequency" "pg_catalog"."float8",
  "juanqu_v" "pg_catalog"."float8",
  "qianshen_v" "pg_catalog"."float8",
  "weiru_v" "pg_catalog"."float8",
  "pulling_ratio" "pg_catalog"."float8",
  "up_speed" "pg_catalog"."float8",
  "down_speed" "pg_catalog"."float8",
  "up_twist" "pg_catalog"."float8",
  "down_twist" "pg_catalog"."float8",
  "boot_time" "pg_catalog"."float8",
  "initial_stroke" "pg_catalog"."float8",
  "vertebral_angle" "pg_catalog"."float8",
  "crossover_angle" "pg_catalog"."float8",
  "monolithic_concave" "pg_catalog"."float8",
  "weisha_distance" "pg_catalog"."float8",
  "hardedge_width" "pg_catalog"."float8",
  "weisha_time" "pg_catalog"."float8",
  "hardedge_adjust" "pg_catalog"."float8",
  "down_delay" "pg_catalog"."float8",
  "up_delay" "pg_catalog"."float8",
  "stacking_t" "pg_catalog"."float8",
  "stacking_coefficient" "pg_catalog"."float8",
  "spandex_fiber" "pg_catalog"."float8",
  "upper_pack_denier" "pg_catalog"."float8",
  "lower_pack_denier" "pg_catalog"."float8",
  "traverse_shutdown" "pg_catalog"."float8",
  "boot_protect_width" "pg_catalog"."float8",
  "origin_offset_distance" "pg_catalog"."float8",
  "speed_wheel_diameter" "pg_catalog"."float8",
  "transverse_speed" "pg_catalog"."float8",
  "compensation_factor" "pg_catalog"."float8",
  "weight_correction" "pg_catalog"."float8",
  "spindle_diameter" "pg_catalog"."float8",
  "tube_diameter" "pg_catalog"."float8",
  "max_diameter" "pg_catalog"."float8",
  "gauge_set" "pg_catalog"."float8",
  "crankroll_diameter" "pg_catalog"."float8",
  "draftingroll_diameter" "pg_catalog"."float8",
  "feedroll_diameter" "pg_catalog"."float8",
  "t_coefficient" "pg_catalog"."float8",
  "hardedge_position" "pg_catalog"."float8",
  "anti_flanging_layer" "pg_catalog"."float8",
  "completep" "pg_catalog"."float8"
)
;
```

7.3 1h è§„åˆ™è¯„ä¼°ç»“æœè¡¨ï¼ˆBF21+ï¼‰

### å…«ã€SEC åŸºçº¿ & æ—¥çº§ KPIå±‚

8.1 è®¾å¤‡ SEC åŸºçº¿æ¥æº

```sql
-- è®¾å¤‡ SEC åŸºçº¿è¡¨
CREATE TABLE IF NOT EXISTS public.device_sec_baseline (
    device_id                  text PRIMARY KEY,            -- è®¾å¤‡ IDï¼Œå¦‚ BF1/BF2...
    sec_baseline_kwh_per_kg    double precision NOT NULL,  -- åŸºçº¿å•ä½èƒ½è€—
    sec_source                 text,                       -- åŸºçº¿æ¥æºï¼šNORMAL_CLUSTER/MANUAL/...
    valid_from                 date,                       -- ç”Ÿæ•ˆèµ·å§‹æ—¥æœŸ
    valid_to                   date,                       -- å¯é€‰ï¼šç”Ÿæ•ˆç»“æŸæ—¥æœŸ
    updated_at                 timestamptz DEFAULT now()
);
```

8.2 æ—¥çº§ KPI è¡¨

```sql
-- è®¾å¤‡æ—¥çº§ KPI è¡¨
CREATE TABLE IF NOT EXISTS public.device_daily_kpi (
    device_id             text,
    dt                    date,
    energy_kwh_total      double precision,   -- å½“å¤©æ€»èƒ½è€—
    output_kg_total       double precision,   -- å½“å¤©æ€»äº§é‡
    unit_kwh_per_kg       double precision,   -- å½“å¤©å®é™… SEC
    avg_power_kw          double precision,   -- å½“å¤©å¹³å‡åŠŸç‡
    p95_power_kw_7d       double precision,   -- æœ€è¿‘ 7 å¤©åŠŸç‡ P95
    load_rate_pct_7d      double precision,   -- è´Ÿè·ç³»æ•°
    PRIMARY KEY (device_id, dt)
);
```

